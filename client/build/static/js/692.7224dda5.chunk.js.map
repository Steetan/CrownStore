{"version":3,"file":"static/js/692.7224dda5.chunk.js","mappings":"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","sources":["pages/SettingsUser/SettingsUser.tsx"],"sourcesContent":["import React from 'react'\r\nimport customAxios from '../../axios'\r\nimport { RootState, useAppDispatch } from '../../redux/store'\r\nimport { fetchDeleteMe, setUserImgUrl } from '../../redux/slices/authSlice'\r\nimport { Link, useNavigate } from 'react-router-dom'\r\nimport { useSelector } from 'react-redux'\r\nimport { useForm } from 'react-hook-form'\r\nimport { FormControlLabel, Switch, TextField } from '@mui/material'\r\n\r\nimport { UpdateUserForm } from '../../components'\r\n\r\nexport interface UserData {\r\n\tname: string\r\n\tfname: string\r\n\toname: string\r\n\temail: string\r\n\tphone: number\r\n\tuserPassword?: string\r\n\tuserPasswordRepeat?: string\r\n}\r\n\r\nconst SettingsUser = ({}) => {\r\n\tconst [isAdmin, setIsAdmin] = React.useState(false)\r\n\tconst [isChecked, setIsChecked] = React.useState(false)\r\n\r\n\tconst inputFileRef = React.useRef<HTMLInputElement>(null)\r\n\r\n\tconst {\r\n\t\tregister,\r\n\t\thandleSubmit,\r\n\t\tformState: { errors },\r\n\t} = useForm<UserData>()\r\n\r\n\tconst { userImgUrl } = useSelector((state: RootState) => state.authSlice)\r\n\r\n\tconst dispatch = useAppDispatch()\r\n\tconst navigate = useNavigate()\r\n\r\n\tReact.useEffect(() => {\r\n\t\tconst fetchMe = async () => {\r\n\t\t\tconst { data } = await customAxios.get('auth/meinfo')\r\n\r\n\t\t\tsetIsAdmin(data.access)\r\n\t\t}\r\n\t\tfetchMe()\r\n\t}, [])\r\n\r\n\tconst onClickItemDelete = async () => {\r\n\t\tif (window.confirm('Вы действительно хотите удалить аккаунт?') && !isAdmin) {\r\n\t\t\tawait customAxios.delete('/cart/deleteallbyid')\r\n\t\t\tawait dispatch(fetchDeleteMe(window.localStorage.getItem('token'))).finally(() => {\r\n\t\t\t\twindow.localStorage.removeItem('token')\r\n\t\t\t\tnavigate('/')\r\n\t\t\t})\r\n\t\t\twindow.location.reload()\r\n\t\t}\r\n\t}\r\n\r\n\tconst onClickUpdatePassword = async (values: UserData) => {\r\n\t\ttry {\r\n\t\t\tvalues.userPassword &&\r\n\t\t\t\tvalues.userPassword?.length < 6 &&\r\n\t\t\t\talert('Пароль должен содержать минимум 6 символов')\r\n\t\t\tif (values.userPassword && values.userPassword === values.userPasswordRepeat) {\r\n\t\t\t\tconst { data } = await customAxios.patch('/auth/updpass', {\r\n\t\t\t\t\tpassword: values.userPassword,\r\n\t\t\t\t})\r\n\t\t\t\tdata && alert('Пароль был успешно изменен')\r\n\t\t\t} else {\r\n\t\t\t\talert('Пароли не совпадают')\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log(error)\r\n\t\t\talert('Не удалось обновить пароль')\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleFileChange = async (event: any) => {\r\n\t\ttry {\r\n\t\t\tconst formData = new FormData()\r\n\t\t\tformData.append('image', event.target.files[0])\r\n\r\n\t\t\tawait customAxios\r\n\t\t\t\t.post(`${process.env.REACT_APP_SERVER_URL}/upload/user`, formData)\r\n\t\t\t\t.then(({ data }) => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tdispatch(setUserImgUrl(`${data.url}`))\r\n\t\t\t\t\t\tcustomAxios\r\n\t\t\t\t\t\t\t.patch('/auth/updimg', {\r\n\t\t\t\t\t\t\t\timg: data.url,\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.then(({ data }) => {\r\n\t\t\t\t\t\t\t\tdata && alert('Аватарка была успешно изменена')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tconsole.log(error)\r\n\t\t\t\t\t\talert('Не удалось обновить аватарку')\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t} catch (error) {\r\n\t\t\tconsole.warn(error)\r\n\t\t}\r\n\t}\r\n\r\n\tconst deleteImg = async () => {\r\n\t\tif (window.confirm('Вы действительно хотите удалить аккаунт?')) {\r\n\t\t\ttry {\r\n\t\t\t\tawait customAxios.delete(\r\n\t\t\t\t\t`${process.env.REACT_APP_SERVER_URL}/upload/user/delete/${userImgUrl}`,\r\n\t\t\t\t)\r\n\t\t\t\tif (inputFileRef.current) {\r\n\t\t\t\t\tinputFileRef.current.value = ''\r\n\t\t\t\t}\r\n\r\n\t\t\t\tawait customAxios.patch('/auth/updimg', {\r\n\t\t\t\t\timg: '',\r\n\t\t\t\t})\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.log(error)\r\n\t\t\t}\r\n\t\t\tdispatch(setUserImgUrl(''))\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className='settings'>\r\n\t\t\t<h2 className='settings__title'>Настройки аккаунта</h2>\r\n\t\t\t<div className='settings__main-block'>\r\n\t\t\t\t<UpdateUserForm />\r\n\r\n\t\t\t\t<div className='settings__block-right'>\r\n\t\t\t\t\t<form className='settings__password-block' onSubmit={handleSubmit(onClickUpdatePassword)}>\r\n\t\t\t\t\t\t<h3 className='form-block__title settings__password-title'>Новый пароль</h3>\r\n\t\t\t\t\t\t<div className='settings__password-inputs'>\r\n\t\t\t\t\t\t\t<div className='settings__password-input'>\r\n\t\t\t\t\t\t\t\t<TextField\r\n\t\t\t\t\t\t\t\t\ttype={isChecked ? 'text' : 'password'}\r\n\t\t\t\t\t\t\t\t\tid='outlined-basic'\r\n\t\t\t\t\t\t\t\t\tlabel='Пароль'\r\n\t\t\t\t\t\t\t\t\tclassName='form-block__input form-block__input--password'\r\n\t\t\t\t\t\t\t\t\tvariant='outlined'\r\n\t\t\t\t\t\t\t\t\t{...register('userPassword', { required: 'Укажите пароль' })}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t{errors.userPassword && (\r\n\t\t\t\t\t\t\t\t\t<p style={{ color: 'red' }}>{errors.userPassword.message}</p>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className='settings__password-hr'></div>\r\n\t\t\t\t\t\t\t<div className='settings__password-input'>\r\n\t\t\t\t\t\t\t\t<TextField\r\n\t\t\t\t\t\t\t\t\ttype={isChecked ? 'text' : 'password'}\r\n\t\t\t\t\t\t\t\t\tid='outlined-basic'\r\n\t\t\t\t\t\t\t\t\tlabel='Пароль еще раз'\r\n\t\t\t\t\t\t\t\t\tclassName='form-block__input form-block__input--password'\r\n\t\t\t\t\t\t\t\t\tvariant='outlined'\r\n\t\t\t\t\t\t\t\t\t{...register('userPasswordRepeat', { required: 'Укажите пароль еще раз' })}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t{errors.userPasswordRepeat && (\r\n\t\t\t\t\t\t\t\t\t<p style={{ color: 'red' }}>{errors.userPasswordRepeat.message}</p>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<FormControlLabel\r\n\t\t\t\t\t\t\tvalue={isChecked}\r\n\t\t\t\t\t\t\tonChange={() => setIsChecked(!isChecked)}\r\n\t\t\t\t\t\t\tcontrol={<Switch />}\r\n\t\t\t\t\t\t\tlabel='Показать пароль'\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<div className='settings__btn-password-block'>\r\n\t\t\t\t\t\t\t<button className='button button--footer settings__btn-password-update'>\r\n\t\t\t\t\t\t\t\tОбновить пароль\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</form>\r\n\r\n\t\t\t\t\t{!userImgUrl && (\r\n\t\t\t\t\t\t<label htmlFor='file-upload' className='custom-file-upload'>\r\n\t\t\t\t\t\t\tЗагрузить фото\r\n\t\t\t\t\t\t</label>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tid='file-upload'\r\n\t\t\t\t\t\tref={inputFileRef}\r\n\t\t\t\t\t\ttype='file'\r\n\t\t\t\t\t\tstyle={{ display: 'none' }}\r\n\t\t\t\t\t\tonChange={handleFileChange}\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t{userImgUrl && (\r\n\t\t\t\t\t\t<button className='settings__btn-delete' onClick={deleteImg}>\r\n\t\t\t\t\t\t\tУдалить изображение\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tclassName='form-block__img-upload'\r\n\t\t\t\t\t\tsrc={`${process.env.REACT_APP_SERVER_URL}/uploads/userIcons/${userImgUrl}`}\r\n\t\t\t\t\t\talt=''\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<button\r\n\t\t\t\tclassName='settings__btn-delete settings__btn-delete--acc'\r\n\t\t\t\tonClick={onClickItemDelete}\r\n\t\t\t>\r\n\t\t\t\tУдалить аккаунт\r\n\t\t\t</button>\r\n\t\t\t<Link to='/' className='button button--black' style={{ marginTop: 20 }}>\r\n\t\t\t\t<span>Вернуться назад</span>\r\n\t\t\t</Link>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport default SettingsUser\r\n"],"names":["_ref","isAdmin","setIsAdmin","React","isChecked","setIsChecked","inputFileRef","register","handleSubmit","formState","errors","useForm","userImgUrl","useSelector","state","authSlice","dispatch","useAppDispatch","navigate","useNavigate","async","data","customAxios","get","access","fetchMe","_jsxs","className","children","_jsx","UpdateUserForm","onSubmit","_values$userPassword","values","userPassword","length","alert","userPasswordRepeat","patch","password","error","console","log","TextField","type","id","label","variant","required","style","color","message","FormControlLabel","value","onChange","control","Switch","htmlFor","ref","display","formData","FormData","append","event","target","files","post","concat","process","then","_ref2","setUserImgUrl","url","img","_ref3","warn","onClick","window","confirm","delete","current","src","alt","fetchDeleteMe","localStorage","getItem","finally","removeItem","location","reload","Link","to","marginTop"],"sourceRoot":""}